{% load static %}
{% load cart_tags %}

<div class="col-12 col-sm-6 col-md-4 mb-4">
    <div class="card h-100 d-flex flex-column position-relative overflow-hidden">
        <div class="card-shine-effect"></div>
        <div class="cart-image-container">
            <a href="{{ product.get_absolute_url }}" 
            class="flex-grow-1 d-flex align-items-center justify-content-center p-2 position-relative"
            style="z-index: 2;">
                {% if product.image %}
                <img src="{{ product.image.url }}" 
                    class="card-img-top img-fluid mx-auto" 
                    alt="{{ product.name }}">
                {% else %}
                <img src="{% static 'img/no-image.jpg' %}" 
                    class="card-img-top img-fluid" 
                    alt="No image" 
                    style="height: 180px; object-fit: cover; opacity: 0.8;">
                {% endif %}
            </a>
        </div>
        <div class="card-body d-flex flex-column" style="background-color: transparent; z-index: 1;">
            <h5 class="card-title mb-2 text-white">{{ product.name|truncatechars:30 }}</h5>
            <div class="card-actions mt-auto">
                <div class="d-flex justify-content-between align-items-center flex-wrap">
                    <span class="h6 mb-0 text-white price-badge">{{ product.price }} ₽</span>
                    {% comment %} <a id="addToCartBtn" href="{% url 'cart:add' product.id %}" 
                    class="btn btn-translucent-green {% if product|is_in_cart:request %}} disabled{% else %}{% endif %}"
                    style="min-width: 100px;">
                        {% if product|is_in_cart:request %}
                            <i class="bi bi-check-circle-fill"></i> В корзине
                        {% else %}
                            <i class="bi bi-cart-plus"></i> В корзину
                        {% endif %}
                    </a> {% endcomment %}
                    <button 
                        class="btn add-to-cart-btn {% if product|is_in_cart:request %}added-to-cart{% endif %}" 
                        data-product-id="{{ product.id }}"
                        {% if product|is_in_cart:request %}disabled{% endif %}>
                        {% if product|is_in_cart:request %}
                            <i class="bi bi-check-circle-fill"></i> В корзине
                        {% else %}
                            <i class="bi bi-cart-plus"></i> В корзину
                        {% endif %}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
